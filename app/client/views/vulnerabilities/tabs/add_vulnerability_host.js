// Copyright (c) 2014 Tom Steele, Dan Kottmann, FishNet Security
// See the file license.txt for copying permission

Template.addVulnerabilityHost.events({
   'submit form': function(event, tpl) {
     event.preventDefault();
     var projectId = Session.get('projectId');
     var vulnerabilityId = Session.get('vulnerabilityId');
     var ip = tpl.find('[name=string-addr]').value;
     var port = parseInt(tpl.find('[name=port]').value);
     var protocol = tpl.find('[name=protocol]').value || 'tcp';
     Meteor.call('addHostToVulnerability', projectId, vulnerabilityId, ip, port, protocol, function(err) {
        if (err) {
          return Alerts.insert({"class": "alert-error", "strong": "Error", "message": err.reason});
        }
        return Router.go('/project/' + projectId + '/vulnerabilities/' + vulnerabilityId + '/hosts');
     });
   }
});
